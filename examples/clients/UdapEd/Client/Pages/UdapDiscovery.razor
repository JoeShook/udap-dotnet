@page "/udapDiscovery"


<ErrorBoundary @ref="ErrorBoundary">
  <ChildContent>
    <MudGrid Class="mt-4">
      <MudItem xs="12" sm="12" md="12">
        <MudText Typo="Typo.h4">Udap Metadata</MudText>
      </MudItem>
      <MudItem xs="12" sm="12" md="12">
        <MudGrid Spacing="2" Justify="Justify.FlexStart">
          <MudItem>
            <MudButton Class="mt-3"
                       ButtonType="ButtonType.Button"
                       Variant="Variant.Filled"
                       OnClick="GetMetadata">Query</MudButton>
          </MudItem>
          <MudItem>
            <MudButton Class="mt-3"
                       ButtonType="ButtonType.Button"
                       Variant="Variant.Filled"
                       OnClick="RemoveBaseUrl">Remove Base Url</MudButton>
          </MudItem>
        </MudGrid>
        <MudAutocomplete T="string"
                         Label="Enter BaseUrl"
                         AutoFocus="true"
                         HelperText=@($"UDAP Metadata URL: {GetWellKnownUdap(BaseUrl)}")
                         @bind-Value="BaseUrl"
                         @bind-Text="BaseUrl"
                         SearchFuncWithCancel="@GetMetadata"
                         ResetValueOnEmptyText="true" />
      </MudItem>
      <MudGrid Spacing="1" Class="mt-8">
        <MudItem xs="7">
          <MudPaper Class="pa-4 ma-2" Elevation="3">
            <pre>@Result</pre>
          </MudPaper>
        </MudItem>
        <MudItem xs="5">
          <MudPaper Class="pa-4 ma-2" Elevation="3">
              <MudText Align="Align.Right" Color="Color.Tertiary">Discovery | Metadata | Signed | Communities</MudText>
              <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6">
              <MudTabPanel Text="Signed Software Statement">
                    <SignedJwtViewer SignedSoftwareStatement="@AppState.UdapMetadata?.SignedMetadata" />
              </MudTabPanel>
              <MudTabPanel Text="Certificates">
                <CertificateViewer JwtHeaderWithx5c="@GetJwtHeader()" />
              </MudTabPanel>
            </MudTabs>
          </MudPaper>
        </MudItem>
      </MudGrid>

    </MudGrid>


  </ChildContent>
  <ErrorContent Context="ex">
    <pre class="blazor-error-boundary">
            @ex.Message
      </pre>
  </ErrorContent>
</ErrorBoundary>