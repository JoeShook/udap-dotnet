@page "/udapDiscovery"
@using UdapEd.Shared


<ErrorBoundary @ref="ErrorBoundary">
  <ChildContent>
    <MudGrid Class="mt-4">
        <MudItem xs="12" >
            <MudText Typo="Typo.h4">Udap Metadata</MudText>
        </MudItem>
      <MudItem xs="12">
        <MudCard Class="pa-2 ma-2" Elevation="3">
            <MudCardActions>
                
              <MudGrid Spacing="2" Justify="Justify.FlexStart">
              <MudItem  >
                        <MudButton Class="mt-3"
                                   Color="Color.Primary"
                                   ButtonType="ButtonType.Button"
                                   Variant="Variant.Filled"
                                   OnClick="GetMetadata">Query</MudButton>
                    </MudItem>
              <MudItem >
                        <MudButton Class="mt-3"
                                   Color="Color.Primary"
                                   ButtonType="ButtonType.Button"
                                   Variant="Variant.Filled"
                                   OnClick="RemoveBaseUrl">Remove Base Url</MudButton>
                    </MudItem>
                </MudGrid>
            </MudCardActions>
            <MudCardContent>
                <MudGrid Spacing="2" Justify="Justify.FlexStart">
                    <MudItem xs="8">
                        <MudAutocomplete T="string"
                                         Label="Enter BaseUrl"
                                         AutoFocus="true"
                                         HelperText=@($"UDAP Metadata URL: {RequestUrl.GetWellKnownUdap(BaseUrl, Community)}")
                             @bind-Value="BaseUrl"
                                         @bind-Text="BaseUrl"
                                         SearchFuncWithCancel="@GetMetadata"
                                         ResetValueOnEmptyText="true" />
                    </MudItem>
                    <MudItem xs="4">
                        <MudTextField @bind-Value="Community" Label="Community" Variant="Variant.Text"></MudTextField>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
        </MudCard>

      </MudItem>
      <MudGrid Spacing="1" Class="mt-8">
        <MudItem sm="6" xs="12">
          <MudPaper Class="udap-input" Elevation="3">
            <pre>@Result</pre>
          </MudPaper>
        </MudItem>
        <MudItem sm="6" xs="12">
          <MudPaper Class="udap-analyzed" Elevation="3">
            <MudText Align="Align.Right" Color="Color.Tertiary">Discovery | Metadata | Signed | Communities</MudText>
            <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-2">
              <MudTabPanel Text="Signed Software Statement">
                <SignedJwtViewer Title="<b>Decoded software_statement::</b>" SignedSoftwareStatement="@AppState.UdapMetadata?.SignedMetadata" />
              </MudTabPanel>
              <MudTabPanel Text="Certificates">
                <CertificateViewer JwtHeaderWithx5c="@GetJwtHeader()" />
              </MudTabPanel>
            </MudTabs>
          </MudPaper>
        </MudItem>
      </MudGrid>

    </MudGrid>


  </ChildContent>
  <ErrorContent Context="ex">
    <pre class="blazor-error-boundary">
            @ex.Message
      </pre>
  </ErrorContent>
</ErrorBoundary>